

<!doctype html>

<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>RaspberryPiシステム設定 &#8212; RasPiMouse MRPT  ドキュメント</title>
    <link rel="stylesheet" href="_static/override.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script src="_static/translations.js"></script>
    <script src="_static/bizstyle.js"></script>
    <link rel="index" title="索引" href="genindex.html" />
    <link rel="search" title="検索" href="search.html" />
    <link rel="next" title="RTコンポーネントの起動方法" href="start_rtc.html" />
    <link rel="prev" title="パッケージインストール" href="install_pkg.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <!--[if lt IE 9]>
    <script src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="総合索引"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="start_rtc.html" title="RTコンポーネントの起動方法"
             accesskey="N">次へ</a> |</li>
        <li class="right" >
          <a href="install_pkg.html" title="パッケージインストール"
             accesskey="P">前へ</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">RasPiMouse MRPT  ドキュメント</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">RaspberryPiシステム設定</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="raspberrypi">
<h1><a class="toc-backref" href="#id2">RaspberryPiシステム設定</a><a class="headerlink" href="#raspberrypi" title="このヘッドラインへのパーマリンク">¶</a></h1>
<div class="contents topic" id="id1">
<p class="topic-title">目次</p>
<ul class="simple">
<li><p><a class="reference internal" href="#raspberrypi" id="id2">RaspberryPiシステム設定</a></p>
<ul>
<li><p><a class="reference internal" href="#raspberrypimouselan" id="id3">RaspberryPiMouseの無線LANのアクセスポイント化</a></p></li>
<li><p><a class="reference internal" href="#web" id="id4">Webサーバーのセットアップ</a></p></li>
<li><p><a class="reference internal" href="#pc" id="id5">クライアント用PCの設定</a></p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="raspberrypimouselan">
<h2><a class="toc-backref" href="#id3">RaspberryPiMouseの無線LANのアクセスポイント化</a><a class="headerlink" href="#raspberrypimouselan" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>RasPiMouse2019を使用する場合、無線LANを外部ネットワークに接続して
使用しても良いのですが、複数のRasPiMouse2019で講習会を行うことを
想定すると個々のRasPiMouse2019の無線LANをアクセスポイント化し
クライアントPCとダイレクト接続して利用する方が便利です。</p>
<p>そこで、ここではRasPiMouse2019の無線LANをアクセスポイント化について
説明します。</p>
<p>RasPiMouse2019の無線LANのアクセスポイント化には、hostapdとdnsmasq というソフトウェアが
が必要になります。
下記のようにapt-getコマンドでインストールしてください。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo apt-get install hostapd dnsmasq
</pre></div>
</div>
<p>次に、hostaptdとdnsmasqの設定を行います。
hostapdの設定を行うために、/etc/hostapd/hostapd.conf を下のような内容で作成してください。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">interface</span><span class="o">=</span><span class="n">wlan0</span>
<span class="n">driver</span><span class="o">=</span><span class="n">nl80211</span>
<span class="n">ssid</span><span class="o">=&lt;</span><span class="n">SSID</span><span class="o">&gt;</span>
<span class="n">hw_mode</span><span class="o">=</span><span class="n">g</span>
<span class="n">channel</span><span class="o">=</span><span class="mi">4</span>
<span class="n">wmm_enabled</span><span class="o">=</span><span class="mi">0</span>
<span class="n">macaddr_acl</span><span class="o">=</span><span class="mi">0</span>
<span class="n">auth_algs</span><span class="o">=</span><span class="mi">1</span>
<span class="n">wpa</span><span class="o">=</span><span class="mi">2</span>
<span class="n">wpa_key_mgmt</span><span class="o">=</span><span class="n">WPA</span><span class="o">-</span><span class="n">PSK</span>
<span class="n">rsn_pairwise</span><span class="o">=</span><span class="n">CCMP</span>
<span class="n">wpa_passphrase</span><span class="o">=&lt;</span><span class="n">PASSWORD</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>上記のファイル内容で &lt;SSID&gt; 及び &lt;PASSWORD&gt; は、RasPiMouse2019は
個々の機体ごとに任意の文字列で設定してください。(ただし、&lt;PASSWORD&gt;は8文字以上にしてください)</p>
<p>次にRasPiMouse2019の機体のIPアドレスを固定アドレスで運用できるように設定します。
Raspbian Busterでは、dhcpcdというDHCPクライアントによって各ネットワークデバイス
IPアドレスを設定しています。
dhcpcdの設定ファイルは /etc/dhcpcd.conf になりますので、
このファイルに下記のように固定アドレスの設定を追記してください。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="o">....</span>
  <span class="o">....</span>

<span class="n">interface</span> <span class="n">wlan0</span>
<span class="n">static</span> <span class="n">ip_address</span><span class="o">=</span><span class="mf">192.168</span><span class="o">.</span><span class="mf">11.1</span><span class="o">/</span><span class="mi">24</span>
<span class="n">static</span> <span class="n">routers</span><span class="o">=</span><span class="mf">192.168</span><span class="o">.</span><span class="mf">11.1</span>
<span class="n">static</span> <span class="n">domain_name_servers</span><span class="o">=</span><span class="mf">192.168</span><span class="o">.</span><span class="mf">11.1</span> <span class="mf">8.8</span><span class="o">.</span><span class="mf">8.8</span>
<span class="n">nohook</span> <span class="n">wpa_supplicant</span>
</pre></div>
</div>
<p>ここでは、RasPiMouse2019の無線LANのIPアドレスを 192.168.11.1/24 という
プライベートアドレスに設定しています。
また、Raspbian Busterの dhcpcdでは、無線LANのネットワークデバイスの設定
には、wpa_supplicantというマネージャーを自動起動してしまいます。
そのため、無線LANアクセスポイントを利用する場合には、wpa_supplicantの起動を
抑制するために &quot;nohook wpa_supplicant&quot; を末尾に追加しています。</p>
<p>ただし、このwpa_suplicantの自動起動機能の抑制は、全ての無線LAN機器に
対して有効になりますので、他のUSBの無線LANを付けてもwap_supplicantが
機能せず、無線LANの自動接続しませんので注意してください。</p>
<p>次に、無線LANアクセスポイントに接続するクライアントPCへIPアドレスを割り当てる
DHCPサーバー機能を有効にします。</p>
<p>DHCPサーバーとして使用する dnsmasq の設定ファイルは、/etc/dnsmasq.conf にありますので、
下記の内容を追記してください。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">no</span><span class="o">-</span><span class="n">resolv</span>
<span class="n">no</span><span class="o">-</span><span class="n">poll</span>
<span class="n">dhcp</span><span class="o">-</span><span class="nb">range</span><span class="o">=</span><span class="mf">192.168</span><span class="o">.</span><span class="mf">11.10</span><span class="p">,</span><span class="mf">192.168</span><span class="o">.</span><span class="mf">11.20</span><span class="p">,</span><span class="mi">12</span><span class="n">h</span>
<span class="n">server</span><span class="o">=</span><span class="mf">192.168</span><span class="o">.</span><span class="mf">11.1</span>
</pre></div>
</div>
<p>ここでは、クライアントPCに配布するIDアドレスとして、192.168.11.10～192.168.11.20の
11個のアドレスに設定しており、そのリース期間は12時間になっています。
また、dhcpサーバーとして機能するIPアドレスは、192.168.11.1になっています。</p>
<p>上記の3つのファイルの追加・修正で内蔵無線LANデバイスのアクセスポイント化の設定は
終了ですが、hostapdがsystemdで起動できない状態のママになっています。</p>
<p>そこで下記のコマンドを実行して、hostapdを起動時に自動実行するように設定してください。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo systemctl unmask hostapd
$ sudo systemctl enable hostapd
</pre></div>
</div>
<p>最後に、Java版の外部からのアクセスを有効にするために、/etc/hostsを変更します。
Raspbian Buster の初期設定では、ホスト名である &quot;raspberrypi&quot; のIPアドレスの設定が、</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">127.0</span><span class="o">.</span><span class="mf">1.1</span>    <span class="n">raspberrypi</span>
</pre></div>
</div>
<p>と記載されています。
このままでは、Java版のRTCに外部のPCからアクセスすることができません。</p>
<p>したがって、上記の部分を下のように修正してください。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">192.168</span><span class="o">.</span><span class="mf">11.1</span>    <span class="n">raspberrypi</span>
</pre></div>
</div>
<p>以上で、RasPiMouse2019の内蔵無線LANデバイスをアクセスポイント化することができましたので、
再起動を実施てアクセスポイントになっていることを確認してください。</p>
</div>
<div class="section" id="web">
<h2><a class="toc-backref" href="#id4">Webサーバーのセットアップ</a><a class="headerlink" href="#web" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>RasPiMouse2019では、CGIを経由して外部PC上のWebブラウザから
ネームサーバの起動、RTC群の制御を行うことができます。</p>
<p>この節では、CGIを利用するためにapache2を導入と設定を行っていきます。
まずは、下記のコマンドを実行してapache2のインストールとCGIの有効化を実行してください。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo apt-get install apache2
$ sudo ln -s /etc/apache2/mods-available/cgi.load /etc/apache2/mods-enabled/cgi.load
</pre></div>
</div>
<p>次に、CGIの設定をファイルの指定のために、
apache2のデフォルト設定ファイルを下のように修正します。</p>
<p>/etc/apache2/sites-available/000-default.conf をエディタで開き、
28行目にある下記の行のコメントをはずします。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Include</span> <span class="n">conf</span><span class="o">-</span><span class="n">available</span><span class="o">/</span><span class="n">serve</span><span class="o">-</span><span class="n">cgi</span><span class="o">-</span><span class="nb">bin</span><span class="o">.</span><span class="n">conf</span>
</pre></div>
</div>
<p>次に、CGIプログラムとしてPythonプログラムファイルを使うためにMIME設定を変更します。</p>
<p>/etc/apache2/mods-available/mime.conf のファイルの219行目にある
下記の行のコメントをはずし '.py'を追加します。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">AddHandler</span> <span class="n">cgi</span><span class="o">-</span><span class="n">script</span> <span class="o">.</span><span class="n">cgi</span> <span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>最後に、CGIプログラムを配置する場所を /var/www/cgi-bin に変更します。
/etc/apache2/conf-available/serve-cgi-bin.conf の11行目と12行目に記載されている
CGIプログラムの設置場所を下記のように変更してください。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ScriptAlias</span> <span class="o">/</span><span class="n">cgi</span><span class="o">-</span><span class="nb">bin</span><span class="o">/</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">cgi</span><span class="o">-</span><span class="nb">bin</span>
<span class="o">&lt;</span><span class="n">Directory</span> <span class="s2">&quot;/var/www/cgi-bin&quot;</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>以上で、apache2のインストールとCGIの設定は終了です。
apache2を再起動するために下記のコマンドを実行してください。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo service apache2 restart
</pre></div>
</div>
</div>
<div class="section" id="pc">
<h2><a class="toc-backref" href="#id5">クライアント用PCの設定</a><a class="headerlink" href="#pc" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>RasPiMouse2019のナビゲーションRTC群の中でNavigationManagerは、Javaで実装され
GUIパネルを含んでいます。</p>
<p>そのため RasPiMouse2019上でNavigationManagerを動作させるには、
クライアントPCにX-WindowのXサーバーが必要になります。
Linux端末等UNIX系OSには、GUIシステムとしてXだサーバが利用されていますが、
Windows10などのMicrosoftのOSには、Xサーバーを別途インストールする必要があります。</p>
<p>Windows上で実行可能なXサーバーとして、
<a class="reference external" href="https://www.microsoft.com/ja-jp/p/x410/9nlp712zmn9q?activetab=pivot:overviewtab">有償のX410</a>
または <a class="reference external" href="https://sourceforge.net/projects/vcxsrv/">VcXsrv</a>
がありますので、どちらのアプリケーションをインストールしてください。</p>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">クイック検索</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="検索" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script><div id="toc" class="sidebarRow">

    <h4><a href="index.html">目次</a></h4>
        <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="raspbian_setup.html">RaspberryPiMouseセットアップ</a></li>
<li class="toctree-l1"><a class="reference internal" href="install_pkg.html">パッケージインストール</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">RaspberryPiシステム設定</a></li>
<li class="toctree-l1"><a class="reference internal" href="start_rtc.html">RTコンポーネントの起動方法</a></li>
<li class="toctree-l1"><a class="reference internal" href="auto_start.html">RTC自動起動設定</a></li>
<li class="toctree-l1"><a class="reference internal" href="system.html">SLAMによるナビゲーション</a></li>
<li class="toctree-l1"><a class="reference internal" href="build_rtc.html">（付録）RTCのコンパイル</a></li>
</ul>

    
</div>
  <h4>前のトピックへ</h4>
  <p class="topless"><a href="install_pkg.html"
                        title="前の章へ">パッケージインストール</a></p>
  <h4>次のトピックへ</h4>
  <p class="topless"><a href="start_rtc.html"
                        title="次の章へ">RTコンポーネントの起動方法</a></p>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="総合索引"
             >索引</a></li>
        <li class="right" >
          <a href="start_rtc.html" title="RTコンポーネントの起動方法"
             >次へ</a> |</li>
        <li class="right" >
          <a href="install_pkg.html" title="パッケージインストール"
             >前へ</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">RasPiMouse MRPT  ドキュメント</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">RaspberryPiシステム設定</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019, AIST.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.2.1.
    </div>
  </body>
</html>