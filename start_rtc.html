

<!doctype html>

<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>RTコンポーネントの起動方法 &#8212; RasPiMouse MRPT  ドキュメント</title>
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/override.css" type="text/css" />
    
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script src="_static/translations.js"></script>
    <script src="_static/bizstyle.js"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="index" title="索引" href="genindex.html" />
    <link rel="search" title="検索" href="search.html" />
    <link rel="next" title="RTC自動起動設定" href="auto_start.html" />
    <link rel="prev" title="RaspberryPiシステム設定" href="ap_setup.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <!--[if lt IE 9]>
    <script src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="総合索引"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="auto_start.html" title="RTC自動起動設定"
             accesskey="N">次へ</a> |</li>
        <li class="right" >
          <a href="ap_setup.html" title="RaspberryPiシステム設定"
             accesskey="P">前へ</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">RasPiMouse MRPT  ドキュメント</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">RTコンポーネントの起動方法</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="rt">
<h1><a class="toc-backref" href="#id4">RTコンポーネントの起動方法</a><a class="headerlink" href="#rt" title="このヘッドラインへのパーマリンク">¶</a></h1>
<div class="contents topic" id="id1">
<p class="topic-title">目次</p>
<ul class="simple">
<li><p><a class="reference internal" href="#rt" id="id4">RTコンポーネントの起動方法</a></p>
<ul>
<li><p><a class="reference internal" href="#x-server" id="id5">X-serverのインストールと起動</a></p></li>
<li><p><a class="reference internal" href="#webrtc" id="id6">Webブラウザを用いたRTCの起動</a></p>
<ul>
<li><p><a class="reference internal" href="#id2" id="id7">ネームサーバーの起動</a></p></li>
<li><p><a class="reference internal" href="#rtc" id="id8">ナビゲーションRTC群の操作</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#id3" id="id9">コマンドラインからRTCの起動</a></p></li>
<li><p><a class="reference internal" href="#pcmapserver-navigationmanager" id="id10">PC側でのMapServer/NavigationManagerの起動</a></p></li>
</ul>
</li>
</ul>
</div>
<p>ここでは、RasPiMouse2019を操作するRTC群の起動方法について説明します。
RasPiMouse2019のナビゲーションのためのRTC群は、以下の8種類あります。</p>
<ul class="simple">
<li><p>RaspberryPiMouseRTC: RaspberrryPiMouseドライバRTC</p></li>
<li><p>RPLidarRTC: LiDAR制御RTC</p></li>
<li><p>Mapper_MRPT: Map作成RTC</p></li>
<li><p>Localization_MRPT: 自己位置推定RTC</p></li>
<li><p>PathPlanner_MRPT: パス生成RTC</p></li>
<li><p>SimplePathFollower: 経路追従RTC</p></li>
<li><p>MapServer: マップサーバ</p></li>
<li><p>NavigationManager: 操作GUI</p></li>
</ul>
<p>これらのRTCはすべてRaspberryPiMouse上で動作させることもできますし、操作の都合上
MapServer/NavigationManager については、ノートPC側で動作させる方が便利なケースがあり
以下の2通りの方法から選択することができます。</p>
<ul class="simple">
<li><p>MapServer/NavigationManager をPC、その他をRaspBerryPi上で起動する方法（推奨）</p></li>
<li><p>すべてのRTCをRasspberryPi上で起動する方法</p></li>
</ul>
<p>ここでは、両方のケースについて説明していきます。</p>
<p>また、RaspberryPi上で起動するRTCの操作は、Webブラウザで操作する方法と
PCからssh(TeraTerm等のターミナルソフト) でRaspberryPiにログインして
操作する以下の2種類の方法があります。</p>
<ul class="simple">
<li><p>Webブラウザ経由で起動・操作する方法（推奨）</p></li>
<li><p>sshログインして起動・操作する方法</p></li>
</ul>
<p>これらの方法についてもそれぞれ説明します。</p>
<div class="section" id="x-server">
<h2><a class="toc-backref" href="#id5">X-serverのインストールと起動</a><a class="headerlink" href="#x-server" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>この項目は、「MapServer/NavigationManager」をPCで起動する場合は
必要ありませんのでスキップしてください。</p>
<p>上記 NavigationManagerはGUI表示のあるRTCなので、通常RaspberryPi上で起動すると、
そのGUI画面はRaspberyPi上で表示されてしまいます。
ただし、Linux等の`X Window System &lt;<a class="reference external" href="https://ja.wikipedia.org/wiki/X_Window_System">https://ja.wikipedia.org/wiki/X_Window_System</a>&gt;`_では、
特定のアプリケーション画面を他のPCに表示させることができるので、
この機能を応用すると、RaspberryPi上で実行するNavigationManagerのGUI画面を
手元のPCに表示させることができます。</p>
<p>この項目では、そのために必要な方法を説明していきます。
ただし、X Window System でGUI画面を表示させる方法は大きな通信帯域を
消費するため、操作はかなり重いものとなることをあらかじめご承知おきください。</p>
<p>X Window System を利用してWindows上でリモート（ここではRaspberryPi側）の
アプリケーションのGUI画面を表示させるには、X Serverと呼ばれるソフトウェアを
インストールする必要があります。</p>
<p>ここでは、無償のVcXsrvというX-serverを利用する方法を説明します。
まず、以下のURLから VcXsrv をダウンロードしてください。</p>
<ul class="simple">
<li><p><a class="reference external" href="https://sourceforge.net/projects/vcxsrv/">VcXsrv</a></p></li>
</ul>
<p>ダウンロードしたインストーラを実行してVcXsrvをインストールします。
インストール後、スタートメニューから XLaunch というアプリケーションを起動します。
起動後ダイアログが現れて、設定が進みますが、途中のExtra Settingsのダイアログで
Disable access control というチェックボックスにチェックを入れて進んでください。</p>
<img alt="_images/xlaunch03.png" src="_images/xlaunch03.png" />
<p>その後X-serverが起動します。タスクバー右端の常駐アプリアイコンから起動しているかどうかを確認できます。</p>
</div>
<div class="section" id="webrtc">
<h2><a class="toc-backref" href="#id6">Webブラウザを用いたRTCの起動</a><a class="headerlink" href="#webrtc" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>電源を投入し、RasPiMouse を起動させます。
クライアントPCの無線LANのマネージャーからhostapd.confで設定したSSIDが
見えることを確認し、接続してください。</p>
<p>WindowsPCの場合には、タスクバーの右側のWifiの設定から接続することができます。
接続時には、パスワードを入力する必要がありますので、hostapd.confに記載した
passwordを入力してください。
(講習会では、SSID: RPiMouse&lt;番号&gt;、PW: openrtm-aistに設定されています。)</p>
<p>正常に接続できれば、192.168.11.XX というIPアドレスが設定されているはずですので、
ipconfigコマンド等で確認してください。</p>
<img alt="_images/ipconfig.png" src="_images/ipconfig.png" />
<p>IPアドレスの確認終了後、RasPiMouse2019（IPアドレス: 192.168.11.1）に
Webブラウザから接続してください。
下のようなページが出力されれば正常に動作しています。</p>
<img alt="_images/web.png" src="_images/web.png" />
<div class="section" id="id2">
<h3><a class="toc-backref" href="#id7">ネームサーバーの起動</a><a class="headerlink" href="#id2" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>起動直後ではネームサーバーが動作していないため、2段目の &quot;RTC LIST&quot;の部分は、
下のようなエラー表示になっています。</p>
<img alt="_images/web-1.png" src="_images/web-1.png" />
<p>ナビゲーションRTC群を含むOpenRTM-aistをベースとしたRTコンポーネントでは、
ネームサーバーが必要なため、「Start NameServer」ボタンをクリックして起動してください。</p>
<p>ボタンをクリック後は、起動メッセージのページに移行し、3秒後にトップページに移動します。
移動後、しばらくすれば &quot;RTC LIST&quot;の部分が下記のようになります。</p>
<img alt="_images/web-2.png" src="_images/web-2.png" />
<p>このようにエラーメッセージが表示されない場合は、ネームサーバが正常に動作しています。</p>
</div>
<div class="section" id="rtc">
<h3><a class="toc-backref" href="#id8">ナビゲーションRTC群の操作</a><a class="headerlink" href="#rtc" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>トップページの最初のセクションには、下図のように
RasPiMouse2019のナビゲーションに用いるRTCの名称および
操作のCGIプログラムへのリンクの一覧が表示されています。</p>
<img alt="_images/web1.png" src="_images/web1.png" />
<p>ここのRTCの起動、終了、アクティベート、デアクティベートをこれらのリンクを押下することで
操作することができます。</p>
<p>各RTCの起動後は、第2セクションの &quot;RTC List&quot;　にある「List」ボタンを押下することで、
ネームサーバーに登録されているRTCの一覧を更新、表示することができます。</p>
</div>
</div>
<div class="section" id="id3">
<h2><a class="toc-backref" href="#id9">コマンドラインからRTCの起動</a><a class="headerlink" href="#id3" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>Webブラウザからでは、現在、個々のRTCの起動、終了、アクティベート、デアクティベートに対応していますが、
RTCの強制終了やエラー時の対応など細かい操作を行うことができません。</p>
<p>RTCの強制終了やエラー時の対応など細かい操作が必要な場合には、
クライアントPCのターミナルからssh経由でログインしてコマンドラインのオペレーションを実行してください。</p>
<p>WindowsPCからのsshによるアクセスは、
<a class="reference external" href="https://ja.osdn.net/projects/ttssh2/">TaraTerm</a> や
<a class="reference external" href="https://www.chiark.greenend.org.uk/~sgtatham/putty/">PuTTY</a>
, <a class="reference external" href="https://mintty.github.io/">mintty</a> 等のターミナルエミュレータを利用してください。
各ソフトウェアの詳細は、それぞれのプロジェクトページを参照してください。</p>
<p>RasPiMouse2019へsshでログイン後は、rtshell等を使用してエラーの回復や
各RTCのプロセスの強制終了等を行うことができます。</p>
<p>また、ナビゲーションRTCの設定ファイルや起動スクリプトは、/usr/local/openrtm の下に配置されています。
RTCの個別起動は、/usr/local/openrtm/bin/&lt;RTC名&gt;.sh というファイル名で作成されており、
各RTCの設定ファイルは、/usr/local/openrtm/etc/&lt;RTC名&gt;.conf として配置されています。</p>
<p>後述するマップ作成(Mapper)、位置検出(localize)、経路生成(path_plan)のシステム制御用
スクリプトは、/usr/lcoal/openrtm の下に、mapper.sh, localize.sh, path_plan.sh　として
配置されています。</p>
<p>これらのシステム制御用のスクリプトは、第2引数として start, stop, connect, disconnect, activate, deactivate
のコマンドを指定することで制御すると都ができます。</p>
<p>例えば、マップ作成のシステムを開始するには、事前にクライアントPCでXサーバーを起動後、</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ export DISPLAY=&lt;クライアントPCのIPアドレス&gt;:0.0
$ /usr/local/openrtm/mapper.sh start
$ /usr/local/openrtm/mapper.sh connect
$ /usr/local/openrtm/mapper.sh activate
</pre></div>
</div>
<p>によって各RTCの起動、ポートの接続、アクティベートを行うことができます。
なお、最初のコマンドは、NavigationManagerのGUIパネルを表示させるための設定です。</p>
<p>また、終了時には下記のコマンドでRTCを終了させることができます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ /usr/local/openrtm/mapper.sh deactivate
$ /usr/local/openrtm/mapper.sh stop
</pre></div>
</div>
</div>
<div class="section" id="pcmapserver-navigationmanager">
<h2><a class="toc-backref" href="#id10">PC側でのMapServer/NavigationManagerの起動</a><a class="headerlink" href="#pcmapserver-navigationmanager" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>このシステムでは、まず
(1)地図作成モードでNavigationManagerを使い地図を作成、
(2)作成した地図データをMapServerが読み込むファイル名でコピー、
(3)ナビゲーションモードでMapServerを含めて必要なRTCを起動してナビゲーションを行う、
といった手順で移動ロボットを動作させます。</p>
<p>このような手順のため、NavigationManagerとMapServerは同一PCにある方が
作業がやりやすいため、これら2つのコンポーネントについては、RasPiMouse側ではなく
PC側で起動した方が効率的です。</p>
<p>これら2つのコンポーネントはJavaで記述されているため、同一のバイナリを
RasPiMouse側でもPC (Windows, Linux, MacOS等）側でも起動可能です。</p>
<p>MapServer/NavigationManager の実行ファイルを以下の場所から
ダウンロードしZIPファイルを展開します。</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/OpenRTM/RasPiMouse_with_MRPT/raw/master/bin/Navigation.zip">MapServer/NavigationManager</a></p></li>
</ul>
<p>展開すると、Navigation というディレクトリの下に、</p>
<ul class="simple">
<li><p>NavigationManager.bat</p></li>
<li><p>MapServer.bat</p></li>
</ul>
<p>というバッチファイルが現れます。以下の地図作成やナビゲーションの必要なタイミングで、
これらのバッチファイルをダブルクリックして起動してください。</p>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">クイック検索</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="検索" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script><div id="toc" class="sidebarRow">

    <h4><a href="index.html">目次</a></h4>
        <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="raspbian_setup.html">RaspberryPiMouseセットアップ</a></li>
<li class="toctree-l1"><a class="reference internal" href="install_pkg.html">パッケージインストール</a></li>
<li class="toctree-l1"><a class="reference internal" href="ap_setup.html">RaspberryPiシステム設定</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">RTコンポーネントの起動方法</a></li>
<li class="toctree-l1"><a class="reference internal" href="auto_start.html">RTC自動起動設定</a></li>
<li class="toctree-l1"><a class="reference internal" href="system.html">SLAMによるナビゲーション</a></li>
<li class="toctree-l1"><a class="reference internal" href="build_rtc.html">（付録）RTCのコンパイル</a></li>
</ul>

    
</div>
  <h4>前のトピックへ</h4>
  <p class="topless"><a href="ap_setup.html"
                        title="前の章へ">RaspberryPiシステム設定</a></p>
  <h4>次のトピックへ</h4>
  <p class="topless"><a href="auto_start.html"
                        title="次の章へ">RTC自動起動設定</a></p>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="総合索引"
             >索引</a></li>
        <li class="right" >
          <a href="auto_start.html" title="RTC自動起動設定"
             >次へ</a> |</li>
        <li class="right" >
          <a href="ap_setup.html" title="RaspberryPiシステム設定"
             >前へ</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">RasPiMouse MRPT  ドキュメント</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">RTコンポーネントの起動方法</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019, AIST.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.3.0.
    </div>
  </body>
</html>